<!-- Generator: GNU source-highlight 
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><font color="#000000">001:</font> <font color="#990000">&lt;?php</font>
<font color="#000000">002:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">003:</font> <i><font color="#9A1900">CircaLib.php3 : provide function to perform search on Circa with PHP</font></i>
<font color="#000000">004:</font> <i><font color="#9A1900">Copyright 2000 A.Barbet </font></i><u><font color="#0000FF">alian@alianwebserver.com.</font></u><i><font color="#9A1900">  All rights reserved.</font></i>
<font color="#000000">005:</font> 
<font color="#000000">006:</font> <i><font color="#9A1900">Revision 1.1  2000/11/23 22:51:17  Administrateur</font></i>
<font color="#000000">007:</font> <i><font color="#9A1900">addSite.php3</font></i>
<font color="#000000">008:</font> 
<font color="#000000">009:</font> <i><font color="#9A1900">Revision 1.2  2000/10/27 16:01:12  Administrateur</font></i>
<font color="#000000">010:</font> <i><font color="#9A1900">- Navigation par categorie</font></i>
<font color="#000000">011:</font> <i><font color="#9A1900">- Passer le prefixe en variable globale</font></i>
<font color="#000000">012:</font> <i><font color="#9A1900">- Passer la database en variable globale</font></i>
<font color="#000000">013:</font> 
<font color="#000000">014:</font> <i><font color="#9A1900">Revision 1.1  2000/10/22 22:43:47  Administrateur</font></i>
<font color="#000000">015:</font> <i><font color="#9A1900">Premiere version fonctionnelle. Supporte:</font></i>
<font color="#000000">016:</font> <i><font color="#9A1900">- Requetes booleenes</font></i>
<font color="#000000">017:</font> <i><font color="#9A1900">- Affichage par pages de 10 liens</font></i>
<font color="#000000">018:</font> 
<font color="#000000">019:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">020:</font> 
<font color="#000000">021:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">022:</font> 
<font color="#000000">023:</font> <i><font color="#9A1900">Fonction permettant d'effectuer une recherche par mot dans Circa</font></i>
<font color="#000000">024:</font> 
<font color="#000000">025:</font> <i><font color="#9A1900">Paramètres :</font></i>
<font color="#000000">026:</font> 
<font color="#000000">027:</font> <i><font color="#9A1900"> $template : Masque HTML pour le resultat de chaque lien. La liste des variables définies au</font></i>
<font color="#000000">028:</font> <i><font color="#9A1900"> moment du eval sont : $indiceG,$titre,$description,$url,$facteur,$last_update,$langue</font></i>
<font color="#000000">029:</font> 
<font color="#000000">030:</font> <i><font color="#9A1900">  Exemple de masque :</font></i>
<font color="#000000">031:</font> 
<font color="#000000">032:</font> <i><font color="#9A1900">  '"&lt;p&gt;$indiceG - &lt;a href=\"$url\"&gt;$titre&lt;/a&gt; $description&lt;br&gt;</font></i>
<font color="#000000">033:</font> <i><font color="#9A1900">   &lt;font class=\"small\"&gt;&lt;b&gt;Url:&lt;/b&gt; $url &lt;b&gt;Facteur:&lt;/b&gt; $facteur</font></i>
<font color="#000000">034:</font> <i><font color="#9A1900">   &lt;b&gt;Last update:&lt;/b&gt; $last_update &lt;/font&gt;&lt;/p&gt;\n"'</font></i>
<font color="#000000">035:</font> 
<font color="#000000">036:</font> <i><font color="#9A1900"> $mot    : Séquence des mots recherchés tel que tapé par l'utilisateur</font></i>
<font color="#000000">037:</font> <i><font color="#9A1900"> first   : Indice du premier site affiché dans le résultat</font></i>
<font color="#000000">038:</font> <i><font color="#9A1900"> $id     : Id du site dans lequel effectué la recherche</font></i>
<font color="#000000">039:</font> <i><font color="#9A1900"> $langue : Restriction par langue (facultatif)</font></i>
<font color="#000000">040:</font> <i><font color="#9A1900"> $Url    : Restriction par url : les url trouvées commenceront par $Url (facultatif)</font></i>
<font color="#000000">041:</font> <i><font color="#9A1900"> $create : Restriction par date inscription. Format YYYY-MM-JJ HH:MM:SS (facultatif)</font></i>
<font color="#000000">042:</font> <i><font color="#9A1900"> $update : Restriction par date de mise à jour des pages. Format YYYY-MM-JJ HH:MM:SS (facultatif)</font></i>
<font color="#000000">043:</font> <i><font color="#9A1900"> $catego : Restriction par categorie (facultatif)</font></i>
<font color="#000000">044:</font> 
<font color="#000000">045:</font> <i><font color="#9A1900">Retourne ($resultat,$links,$indice)</font></i>
<font color="#000000">046:</font> 
<font color="#000000">047:</font> <i><font color="#9A1900"> $resultat : Buffer HTML contenant la liste des sites trouves formaté en fonction</font></i>
<font color="#000000">048:</font> <i><font color="#9A1900">             de $template et des mots present dans $mots</font></i>
<font color="#000000">049:</font> <i><font color="#9A1900"> $links    : Liens vers les pages suivantes / precedentes</font></i>
<font color="#000000">050:</font> <i><font color="#9A1900"> $indice   : Nombre de sites trouves</font></i>
<font color="#000000">051:</font> 
<font color="#000000">052:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">053:</font> 
<font color="#000000">054:</font> <b><font color="#000080">include</font></b><font color="#990000">(</font><font color="#FF0000">"foo.php"</font><font color="#990000">);</font>
<font color="#000000">055:</font> <b><font color="#000080">include_once</font></b><font color="#990000">(</font><font color="#FF0000">"bar.php"</font><font color="#990000">);</font>
<font color="#000000">056:</font> 
<font color="#000000">057:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">search</font></b><font color="#990000">(</font><font color="#009900">$template</font><font color="#990000">,</font><font color="#009900">$word</font><font color="#990000">,</font><font color="#009900">$first</font><font color="#990000">,</font><font color="#009900">$idc</font><font color="#990000">,</font><font color="#009900">$langue</font><font color="#990000">,</font><font color="#009900">$Url</font><font color="#990000">,</font><font color="#009900">$create</font><font color="#990000">,</font><font color="#009900">$update</font><font color="#990000">,</font><font color="#009900">$categorie</font><font color="#990000">)</font>
<font color="#000000">058:</font>          <font color="#FF0000">{</font>
<font color="#000000">059:</font>          <font color="#009900">$mots</font> <font color="#990000">=</font> <b><font color="#000000">split</font></b><font color="#990000">(</font> <font color="#FF0000">" "</font><font color="#990000">,</font> <b><font color="#000000">strtolower</font></b><font color="#990000">(</font><font color="#009900">$word</font><font color="#990000">));</font>
<font color="#000000">060:</font>          <font color="#009900">$i</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>
<font color="#000000">061:</font>          <i><font color="#9A1900"># Recherche des requetes booleenes</font></i>
<font color="#000000">062:</font>          <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$valeur</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$mots</font><font color="#990000">))</font>
<font color="#000000">063:</font>                 <font color="#FF0000">{</font>
<font color="#000000">064:</font>                 <b><font color="#0000FF">if</font></b>    <font color="#990000">(</font><font color="#009900">$valeur</font> <font color="#990000">==</font> <font color="#FF0000">'+'</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$ind_and</font><font color="#990000">[]=</font><font color="#009900">$i</font><font color="#990000">;</font><font color="#FF0000">}</font> <i><font color="#9A1900"># Reperage de la position des mots 'and'</font></i>
<font color="#000000">065:</font>                 <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$valeur</font> <font color="#990000">==</font> <font color="#FF0000">'-'</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$ind_not</font><font color="#990000">[]=</font><font color="#009900">$i</font><font color="#990000">;</font><font color="#FF0000">}</font> <i><font color="#9A1900"># Reperage de la position des mots 'not'</font></i>
<font color="#000000">066:</font>                 <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$mots_tmp</font><font color="#990000">[]=</font><font color="#009900">$valeur</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">067:</font>                 <font color="#009900">$i</font><font color="#990000">++;</font>
<font color="#000000">068:</font>                 <font color="#FF0000">}</font>
<font color="#000000">069:</font>          <i><font color="#9A1900"># Recherche SQL</font></i>
<font color="#000000">070:</font>          <font color="#009900">$tab</font> <font color="#990000">=</font> <b><font color="#000000">search_word</font></b><font color="#990000">(</font><b><font color="#000000">join</font></b><font color="#990000">(</font><font color="#FF0000">"','"</font><font color="#990000">,</font><font color="#009900">$mots_tmp</font><font color="#990000">),</font><font color="#009900">$idc</font><font color="#990000">,</font><font color="#FF0000">''</font><font color="#990000">,</font><font color="#FF0000">''</font><font color="#990000">,</font><font color="#FF0000">''</font><font color="#990000">,</font><font color="#FF0000">''</font><font color="#990000">,</font><font color="#FF0000">''</font><font color="#990000">);</font>
<font color="#000000">071:</font>          <i><font color="#9A1900"># On supprime tout ceux qui ne repondent pas aux criteres and si present</font></i>
<font color="#000000">072:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">is_array</font></b><font color="#990000">(</font><font color="#009900">$ind_and</font><font color="#990000">))</font>
<font color="#000000">073:</font>              <font color="#FF0000">{</font><b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$ind</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b><font color="#990000">(</font><font color="#009900">$ind_and</font><font color="#990000">))</font> <font color="#FF0000">{</font><b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$tab_url</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">074:</font>                        <font color="#FF0000">{</font><b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><b><font color="#000000">appartient</font></b><font color="#990000">(</font><font color="#009900">$mots</font><font color="#990000">[</font><font color="#009900">$ind</font><font color="#990000">+</font><font color="#993399">1</font><font color="#990000">],</font><font color="#009900">$tab_url</font><font color="#990000">[</font><font color="#993399">5</font><font color="#990000">]))</font> <font color="#FF0000">{</font><b><font color="#0000FF">unset</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">]);</font><font color="#FF0000">}}}</font><b><font color="#000000">reset</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">075:</font>          <i><font color="#9A1900"># On supprime tout ceux qui ne repondent pas aux criteres not si present</font></i>
<font color="#000000">076:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">is_array</font></b><font color="#990000">(</font><font color="#009900">$ind_not</font><font color="#990000">))</font>
<font color="#000000">077:</font>              <font color="#FF0000">{</font><b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$ind</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b><font color="#990000">(</font><font color="#009900">$ind_not</font><font color="#990000">))</font> <font color="#FF0000">{</font><b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$tab_url</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">078:</font>                        <font color="#FF0000">{</font><b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">appartient</font></b><font color="#990000">(</font><font color="#009900">$mots</font><font color="#990000">[</font><font color="#009900">$ind</font><font color="#990000">+</font><font color="#993399">1</font><font color="#990000">],</font><font color="#009900">$tab_url</font><font color="#990000">[</font><font color="#993399">5</font><font color="#990000">]))</font> <font color="#FF0000">{</font><b><font color="#0000FF">unset</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">]);</font><font color="#FF0000">}}}</font><b><font color="#000000">reset</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">079:</font>          <font color="#009900">$indice</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font><font color="#009900">$nbResultPerPage</font><font color="#990000">=</font><font color="#993399">10</font><font color="#990000">;</font>
<font color="#000000">080:</font>          <font color="#009900">$lasto</font> <font color="#990000">=</font> <font color="#009900">$first</font> <font color="#990000">+</font> <font color="#009900">$nbResultPerPage</font><font color="#990000">;</font>
<font color="#000000">081:</font>          <i><font color="#9A1900"># On met en forme le resultat</font></i>
<font color="#000000">082:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">is_array</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">083:</font>              <font color="#FF0000">{</font>
<font color="#000000">084:</font>              <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$tab_url</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">085:</font>                 <font color="#FF0000">{</font>
<font color="#000000">086:</font>                 <font color="#009900">$indiceG</font><font color="#990000">=</font><font color="#009900">$indice</font><font color="#990000">+</font><font color="#993399">1</font><font color="#990000">;</font>
<font color="#000000">087:</font>                 <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$titre</font><font color="#990000">,</font><font color="#009900">$description</font><font color="#990000">,</font><font color="#009900">$facteur</font><font color="#990000">,</font><font color="#009900">$langue</font><font color="#990000">,</font><font color="#009900">$last_update</font><font color="#990000">,</font><font color="#009900">$mot</font><font color="#990000">)=</font><font color="#009900">$tab_url</font><font color="#990000">;</font>
<font color="#000000">088:</font> 
<font color="#000000">089:</font>                 <b><font color="#0000FF">if</font></b> <font color="#990000">((</font><font color="#009900">$indice</font><font color="#990000">&gt;=</font><font color="#009900">$first</font><font color="#990000">)&amp;&amp;(</font><font color="#009900">$indice</font><font color="#990000">&lt;</font><font color="#009900">$lasto</font><font color="#990000">))</font> <font color="#FF0000">{</font><b><font color="#0000FF">eval</font></b><font color="#990000">(</font><font color="#009900">$template</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">090:</font>                 <i><font color="#9A1900"># Constitution des liens suivants / precedents</font></i>
<font color="#000000">091:</font>                 <b><font color="#0000FF">if</font></b> <font color="#990000">(!(</font><font color="#009900">$indice</font><font color="#990000">%</font><font color="#009900">$nbResultPerPage</font><font color="#990000">))</font>
<font color="#000000">092:</font>                         <font color="#FF0000">{</font>
<font color="#000000">093:</font>                         <font color="#009900">$nbPage</font><font color="#990000">++;</font>
<font color="#000000">094:</font>                         <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$indice</font><font color="#990000">==</font><font color="#009900">$first</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$links</font><font color="#990000">.=</font><font color="#FF0000">"$nbPage- "</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">095:</font>                         <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$links</font><font color="#990000">.=</font><font color="#FF0000">'&lt;a href="'</font><font color="#990000">.</font><b><font color="#000000">get_link</font></b><font color="#990000">(</font><font color="#009900">$indice</font><font color="#990000">,</font><font color="#009900">$word</font><font color="#990000">,</font><font color="#009900">$idc</font><font color="#990000">).</font><font color="#FF0000">'"&gt;'</font><font color="#990000">.</font><font color="#009900">$nbPage</font><font color="#990000">.</font><font color="#FF0000">'&lt;/a&gt;- '</font><font color="#990000">.</font><font color="#FF0000">"\n"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">096:</font>                         <font color="#FF0000">}</font>
<font color="#000000">097:</font>                 <font color="#009900">$indice</font><font color="#990000">++;</font>
<font color="#000000">098:</font>                 <font color="#FF0000">}</font>
<font color="#000000">099:</font>              <font color="#FF0000">}</font>
<font color="#000000">100:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$indice</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$indice</font><font color="#990000">=</font><font color="#FF0000">"$indice sites trouves"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">101:</font>          <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$indice</font><font color="#990000">=</font><font color="#FF0000">"&lt;p&gt;Aucun document trouvé.&lt;/p&gt;"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">102:</font>          <b><font color="#0000FF">return</font></b> <b><font color="#0000FF">array</font></b><font color="#990000">(</font><font color="#009900">$resultat</font><font color="#990000">,</font><font color="#009900">$links</font><font color="#990000">,</font><font color="#009900">$indice</font><font color="#990000">);</font>
<font color="#000000">103:</font>          <font color="#FF0000">}</font>
<font color="#000000">104:</font> 
<font color="#000000">105:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">106:</font> 
<font color="#000000">107:</font> <i><font color="#9A1900">Construction de la requete SQL. Son exploitation est faite par search</font></i>
<font color="#000000">108:</font> 
<font color="#000000">109:</font> <i><font color="#9A1900"> $tab    : Reference du hash où mettre le resultat</font></i>
<font color="#000000">110:</font> <i><font color="#9A1900"> $word   : Mot recherché</font></i>
<font color="#000000">111:</font> <i><font color="#9A1900"> $id     : Id du site dans lequel effectué la recherche</font></i>
<font color="#000000">112:</font> <i><font color="#9A1900"> $langue : Restriction par langue (facultatif)</font></i>
<font color="#000000">113:</font> <i><font color="#9A1900"> $Url    : Restriction par url</font></i>
<font color="#000000">114:</font> <i><font color="#9A1900"> $create : Restriction par date inscription</font></i>
<font color="#000000">115:</font> <i><font color="#9A1900"> $update : Restriction par date de mise à jour des pages</font></i>
<font color="#000000">116:</font> <i><font color="#9A1900"> $catego : Restriction par categorie</font></i>
<font color="#000000">117:</font> 
<font color="#000000">118:</font> <i><font color="#9A1900">Retourne le tableau avec le resultat de la recherche</font></i>
<font color="#000000">119:</font> <i><font color="#9A1900">Le hash est constitué comme tel:</font></i>
<font color="#000000">120:</font> 
<font color="#000000">121:</font> <i><font color="#9A1900">      $tab{$url}[0] : titre</font></i>
<font color="#000000">122:</font> <i><font color="#9A1900">      $tab{$url}[1] : description</font></i>
<font color="#000000">123:</font> <i><font color="#9A1900">      $tab{$url}[2] : facteur</font></i>
<font color="#000000">124:</font> <i><font color="#9A1900">      $tab{$url}[3] : langue</font></i>
<font color="#000000">125:</font> <i><font color="#9A1900">      $tab{$url}[4] : date de dernière modification</font></i>
<font color="#000000">126:</font> <i><font color="#9A1900">   @{$$tab{$url}[5]}: liste des mots trouves pour cet url</font></i>
<font color="#000000">127:</font> 
<font color="#000000">128:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">129:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">search_word</font></b><font color="#990000">(</font><font color="#009900">$word</font><font color="#990000">,</font><font color="#009900">$idc</font><font color="#990000">,</font><font color="#009900">$langue</font><font color="#990000">,</font><font color="#009900">$Url</font><font color="#990000">,</font><font color="#009900">$create</font><font color="#990000">,</font><font color="#009900">$update</font><font color="#990000">,</font><font color="#009900">$categorie</font><font color="#990000">)</font>
<font color="#000000">130:</font>          <font color="#FF0000">{</font>
<font color="#000000">131:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$prefix</font><font color="#990000">;</font>
<font color="#000000">132:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$database</font><font color="#990000">;</font>
<font color="#000000">133:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$langue</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$langue</font><font color="#990000">=</font><font color="#FF0000">" and langue='$langue' "</font><font color="#990000">;</font><font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$langue</font><font color="#990000">=</font> <font color="#FF0000">' '</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">134:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">((</font><font color="#009900">$Url</font><font color="#990000">)&amp;&amp;(</font><font color="#009900">$Url</font> <font color="#990000">!=</font> <font color="#FF0000">'http://'</font><font color="#990000">))</font> <font color="#FF0000">{</font><font color="#009900">$Url</font><font color="#990000">=</font><font color="#FF0000">" and url like '$Url%' "</font><font color="#990000">;</font><font color="#FF0000">}</font>          <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$Url</font><font color="#990000">=</font><font color="#FF0000">' '</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">135:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$create</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$create</font><font color="#990000">=</font><font color="#FF0000">"and unix_timestamp('$create')&lt; unix_timestamp(last_check) "</font><font color="#990000">;</font><font color="#FF0000">}</font>  <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$create</font><font color="#990000">=</font><font color="#FF0000">' '</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">136:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$update</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$update</font><font color="#990000">=</font><font color="#FF0000">"and unix_timestamp('$update')&lt; unix_timestamp(last_update) "</font><font color="#990000">;</font><font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$update</font><font color="#990000">=</font><font color="#FF0000">' '</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">137:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$categorie</font><font color="#990000">)</font> <font color="#FF0000">{}</font>
<font color="#000000">138:</font>          <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$categorie</font><font color="#990000">=</font><font color="#FF0000">' '</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">139:</font>          <font color="#009900">$requete</font> <font color="#990000">=</font> <font color="#FF0000">"</font>
<font color="#000000">140:</font> <font color="#FF0000">                select facteur,url,titre,description,langue,last_update,mot</font>
<font color="#000000">141:</font> <font color="#FF0000">                from   "</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idc</font><font color="#990000">.</font><font color="#FF0000">"links l,"</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idc</font><font color="#990000">.</font><font color="#FF0000">"relation r</font>
<font color="#000000">142:</font> <font color="#FF0000">                where  r.id_site=l.id</font>
<font color="#000000">143:</font> <font color="#FF0000">                and    r.mot in ('$word')</font>
<font color="#000000">144:</font> <font color="#FF0000">                $langue $Url $create $update $categorie</font>
<font color="#000000">145:</font> <font color="#FF0000">                order  by facteur desc"</font><font color="#990000">;</font>
<font color="#000000">146:</font>          <font color="#009900">$result</font> <font color="#990000">=</font> <b><font color="#000000">mysql_db_query</font></b><font color="#990000">(</font><font color="#009900">$database</font><font color="#990000">,</font><font color="#009900">$requete</font><font color="#990000">);</font>
<font color="#000000">147:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$result</font><font color="#990000">)</font> <font color="#FF0000">{</font><b><font color="#0000FF">print</font></b> <font color="#FF0000">"$requete"</font><font color="#990000">;</font><b><font color="#0000FF">return</font></b> <font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">148:</font>          <font color="#009900">$RowCount</font> <font color="#990000">=</font> <b><font color="#000000">MySQL_NUMROWS</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">149:</font>          <b><font color="#0000FF">while</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">&lt;</font><font color="#009900">$RowCount</font><font color="#990000">)</font>
<font color="#000000">150:</font>                 <font color="#FF0000">{</font>
<font color="#000000">151:</font>                 <b><font color="#0000FF">list</font></b> <font color="#990000">(</font><font color="#009900">$facteur</font><font color="#990000">,</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$titre</font><font color="#990000">,</font><font color="#009900">$description</font><font color="#990000">,</font><font color="#009900">$langue</font><font color="#990000">,</font><font color="#009900">$last_update</font><font color="#990000">,</font><font color="#009900">$mot</font><font color="#990000">)=</font> <b><font color="#000000">mysql_fetch_row</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">152:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#009900">$titre</font><font color="#990000">;</font>
<font color="#000000">153:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">]=</font><font color="#009900">$description</font><font color="#990000">;</font>
<font color="#000000">154:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">2</font><font color="#990000">]+=</font><font color="#009900">$facteur</font><font color="#990000">;</font>
<font color="#000000">155:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">3</font><font color="#990000">]=</font><font color="#009900">$langue</font><font color="#990000">;</font>
<font color="#000000">156:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">4</font><font color="#990000">]=</font><font color="#009900">$last_update</font><font color="#990000">;</font>
<font color="#000000">157:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$url</font><font color="#990000">][</font><font color="#993399">5</font><font color="#990000">][]=</font><font color="#009900">$mot</font><font color="#990000">;</font>
<font color="#000000">158:</font>                 <font color="#009900">$i</font><font color="#990000">++;</font>
<font color="#000000">159:</font>                 <font color="#FF0000">}</font>
<font color="#000000">160:</font>          <b><font color="#0000FF">return</font></b> <font color="#009900">$tab</font><font color="#990000">;</font>
<font color="#000000">161:</font>          <font color="#FF0000">}</font>
<font color="#000000">162:</font> 
<font color="#000000">163:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">164:</font> 
<font color="#000000">165:</font> <i><font color="#9A1900">Fonction retournant la liste des categories de la categorie $id dans le site $idr</font></i>
<font color="#000000">166:</font> 
<font color="#000000">167:</font> <i><font color="#9A1900"> $id       : Id de la categorie de depart. Si undef, 0 est utilisé (Considéré comme le "Home")</font></i>
<font color="#000000">168:</font> <i><font color="#9A1900"> $idr           : Id du responsable</font></i>
<font color="#000000">169:</font> <i><font color="#9A1900"> $template : Masque HTML pour le resultat de chaque lien. Si undef, le masque par defaut</font></i>
<font color="#000000">170:</font> <i><font color="#9A1900">             (defini en haut de ce module) sera utlise</font></i>
<font color="#000000">171:</font> 
<font color="#000000">172:</font> <i><font color="#9A1900">Retourne ($resultat,$nom_categorie) :</font></i>
<font color="#000000">173:</font> 
<font color="#000000">174:</font> <i><font color="#9A1900"> $resultat : Buffer contenant la liste des sites formatées en ft de $template</font></i>
<font color="#000000">175:</font> <i><font color="#9A1900"> $nom_categorie : Nom court de la categorie</font></i>
<font color="#000000">176:</font> 
<font color="#000000">177:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">178:</font> 
<font color="#000000">179:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">categories_in_categorie</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$template</font><font color="#990000">)</font>
<font color="#000000">180:</font>          <font color="#FF0000">{</font>
<font color="#000000">181:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$database</font><font color="#990000">;</font>
<font color="#000000">182:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$prefix</font><font color="#990000">;</font>
<font color="#000000">183:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$idr</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$idr</font><font color="#990000">=</font><font color="#993399">1</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">184:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$id</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$id</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">185:</font>          <font color="#009900">$requete</font> <font color="#990000">=</font> <font color="#FF0000">"select id,nom,parent from "</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idr</font><font color="#990000">.</font><font color="#FF0000">"categorie"</font><font color="#990000">;</font>
<font color="#000000">186:</font>          <font color="#009900">$result</font> <font color="#990000">=</font> <b><font color="#000000">mysql_db_query</font></b><font color="#990000">(</font><font color="#009900">$database</font><font color="#990000">,</font><font color="#009900">$requete</font><font color="#990000">);</font>
<font color="#000000">187:</font>          <font color="#009900">$RowCount</font> <font color="#990000">=</font> <b><font color="#000000">MySQL_NUMROWS</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">188:</font>          <font color="#009900">$i</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>
<font color="#000000">189:</font>          <b><font color="#0000FF">while</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">&lt;</font><font color="#009900">$RowCount</font><font color="#990000">)</font>
<font color="#000000">190:</font>                 <font color="#FF0000">{</font>
<font color="#000000">191:</font>                 <b><font color="#0000FF">list</font></b> <font color="#990000">(</font><font color="#009900">$idc</font><font color="#990000">,</font><font color="#009900">$nom</font><font color="#990000">,</font><font color="#009900">$parent</font><font color="#990000">)=</font> <b><font color="#000000">mysql_fetch_row</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">192:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$idc</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]=</font><font color="#009900">$nom</font><font color="#990000">;</font>
<font color="#000000">193:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$idc</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">]=</font><font color="#009900">$parent</font><font color="#990000">;</font>
<font color="#000000">194:</font>                 <font color="#009900">$i</font><font color="#990000">++;</font>
<font color="#000000">195:</font>                 <font color="#FF0000">}</font>
<font color="#000000">196:</font>         <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$val</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">197:</font>                 <font color="#FF0000">{</font>
<font color="#000000">198:</font>                 <font color="#009900">$nom</font><font color="#990000">=</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$key</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">];</font>
<font color="#000000">199:</font>                 <font color="#009900">$parent</font><font color="#990000">=</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$key</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">];</font>
<font color="#000000">200:</font>                 <font color="#009900">$nom_complet</font><font color="#990000">=</font><font color="#FF0000">"&lt;a href=\""</font><font color="#990000">.</font><b><font color="#000000">getenv</font></b><font color="#990000">(</font><font color="#FF0000">'SCRIPT_NAME'</font><font color="#990000">).</font><font color="#FF0000">"?browse=1&amp;id=$idr\"&gt;Accueil&lt;/a&gt;"</font><font color="#990000">.</font><b><font color="#000000">getParent</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">);</font>
<font color="#000000">201:</font>                 <font color="#009900">$links</font> <font color="#990000">=</font> <b><font color="#000000">get_link_categorie</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">);</font>
<font color="#000000">202:</font>                 <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$parent</font><font color="#990000">==</font><font color="#009900">$id</font><font color="#990000">)</font> <font color="#FF0000">{</font><b><font color="#0000FF">eval</font></b><font color="#990000">(</font><font color="#009900">$template</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">203:</font>                 <font color="#FF0000">}</font>
<font color="#000000">204:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">==</font><font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$resultat</font><font color="#990000">=</font><font color="#FF0000">"&lt;p&gt;Plus de catégorie&lt;/p&gt;"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">205:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">!=</font><font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$titre</font> <font color="#990000">=</font> <font color="#FF0000">"&lt;a href=\""</font><font color="#990000">.</font><b><font color="#000000">getenv</font></b><font color="#990000">(</font><font color="#FF0000">'SCRIPT_NAME'</font><font color="#990000">).</font><font color="#FF0000">"?browse=1&amp;id=$idr\"&gt;Accueil&lt;/a&gt; "</font><font color="#990000">.</font><b><font color="#000000">getParent</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">206:</font>         <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font><font color="#009900">$titre</font><font color="#990000">=</font><font color="#FF0000">" "</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">207:</font>         <b><font color="#0000FF">return</font></b> <b><font color="#0000FF">array</font></b><font color="#990000">(</font><font color="#009900">$resultat</font><font color="#990000">,</font><font color="#009900">$titre</font><font color="#990000">);</font>
<font color="#000000">208:</font>         <font color="#FF0000">}</font>
<font color="#000000">209:</font> 
<font color="#000000">210:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">211:</font> 
<font color="#000000">212:</font> <i><font color="#9A1900">Fonction retournant la liste des pages de la categorie $id dans le site $idr</font></i>
<font color="#000000">213:</font> 
<font color="#000000">214:</font> <i><font color="#9A1900"> $id       : Id de la categorie de depart. Si undef, 0 est utilisé (Considéré comme le "Home")</font></i>
<font color="#000000">215:</font> <i><font color="#9A1900"> $idr           : Id du responsable</font></i>
<font color="#000000">216:</font> <i><font color="#9A1900"> $template : Masque HTML pour le resultat de chaque lien. Si undef, le masque par defaut</font></i>
<font color="#000000">217:</font> <i><font color="#9A1900">             (defini en haut de ce module) sera utlise</font></i>
<font color="#000000">218:</font> 
<font color="#000000">219:</font> <i><font color="#9A1900">Retourne le buffer contenant la liste des sites formatées en ft de $template</font></i>
<font color="#000000">220:</font> 
<font color="#000000">221:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">222:</font> 
<font color="#000000">223:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">sites_in_categorie</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$template</font><font color="#990000">)</font>
<font color="#000000">224:</font>          <font color="#FF0000">{</font>
<font color="#000000">225:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$database</font><font color="#990000">;</font>
<font color="#000000">226:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$prefix</font><font color="#990000">;</font>
<font color="#000000">227:</font>          <font color="#009900">$indiceG</font><font color="#990000">=</font><font color="#993399">1</font><font color="#990000">;</font><font color="#009900">$facteur</font><font color="#990000">=</font><font color="#993399">100</font><font color="#990000">;</font>
<font color="#000000">228:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$idr</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$idr</font><font color="#990000">=</font><font color="#993399">1</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">229:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$id</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$id</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">230:</font>          <font color="#009900">$i</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>
<font color="#000000">231:</font>          <font color="#009900">$requete</font> <font color="#990000">=</font> <font color="#FF0000">"select url,titre,description,langue,last_update from "</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idr</font><font color="#990000">.</font><font color="#FF0000">"links where categorie=$id and browse_categorie='1' and parse='1'"</font><font color="#990000">;</font>
<font color="#000000">232:</font>          <font color="#009900">$result</font> <font color="#990000">=</font> <b><font color="#000000">mysql_db_query</font></b><font color="#990000">(</font><font color="#009900">$database</font><font color="#990000">,</font><font color="#009900">$requete</font><font color="#990000">);</font>
<font color="#000000">233:</font>          <font color="#009900">$RowCount</font> <font color="#990000">=</font> <b><font color="#000000">MySQL_NUMROWS</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">234:</font>          <b><font color="#0000FF">while</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">&lt;</font><font color="#009900">$RowCount</font><font color="#990000">)</font>
<font color="#000000">235:</font>                 <font color="#FF0000">{</font>
<font color="#000000">236:</font>                 <b><font color="#0000FF">list</font></b> <font color="#990000">(</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$titre</font><font color="#990000">,</font><font color="#009900">$description</font><font color="#990000">,</font><font color="#009900">$langue</font><font color="#990000">,</font><font color="#009900">$last_update</font><font color="#990000">)=</font> <b><font color="#000000">mysql_fetch_row</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">237:</font>                 <b><font color="#0000FF">eval</font></b><font color="#990000">(</font><font color="#009900">$template</font><font color="#990000">);</font>
<font color="#000000">238:</font>                 <font color="#009900">$indiceG</font><font color="#990000">++;</font><font color="#009900">$i</font><font color="#990000">++;</font>
<font color="#000000">239:</font>                 <font color="#FF0000">}</font>
<font color="#000000">240:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">==</font><font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$resultat</font><font color="#990000">=</font><font color="#FF0000">"&lt;p&gt;Pas de pages dans cette catégorie&lt;/p&gt;"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">241:</font>         <b><font color="#0000FF">return</font></b> <font color="#009900">$resultat</font><font color="#990000">;</font>
<font color="#000000">242:</font>         <font color="#FF0000">}</font>
<font color="#000000">243:</font> 
<font color="#000000">244:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">245:</font> 
<font color="#000000">246:</font> <i><font color="#9A1900">Rend la chaine correspondante à la catégorie $id avec ses rubriques parentes</font></i>
<font color="#000000">247:</font> 
<font color="#000000">248:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">249:</font> 
<font color="#000000">250:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">getParent</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">)</font>
<font color="#000000">251:</font>         <font color="#FF0000">{</font>
<font color="#000000">252:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">((</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">]!=</font><font color="#993399">0</font><font color="#990000">)&amp;&amp;(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]))</font> <font color="#FF0000">{</font><font color="#009900">$parent</font> <font color="#990000">=</font> <b><font color="#000000">getParent</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">],</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">253:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">])</font> <font color="#FF0000">{</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]=</font><font color="#FF0000">'Home'</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">254:</font>         <font color="#009900">$parent</font><font color="#990000">.=</font><font color="#FF0000">"&amp;gt;&lt;a href=\""</font><font color="#990000">.</font><b><font color="#000000">get_link_categorie</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">).</font><font color="#FF0000">'"&gt;'</font><font color="#990000">.</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">].</font><font color="#FF0000">"&lt;/a&gt;"</font><font color="#990000">;</font>
<font color="#000000">255:</font>         <b><font color="#0000FF">return</font></b> <font color="#009900">$parent</font><font color="#990000">;</font>
<font color="#000000">256:</font>         <font color="#FF0000">}</font>
<font color="#000000">257:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">getWLParent</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">)</font>
<font color="#000000">258:</font>         <font color="#FF0000">{</font>
<font color="#000000">259:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">((</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">]!=</font><font color="#993399">0</font><font color="#990000">)&amp;&amp;(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]))</font> <font color="#FF0000">{</font><font color="#009900">$parent</font> <font color="#990000">=</font> <b><font color="#000000">getWLParent</font></b><font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">],</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">);</font><font color="#FF0000">}</font>
<font color="#000000">260:</font>         <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">])</font> <font color="#FF0000">{</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]=</font><font color="#FF0000">'Home'</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">261:</font>         <font color="#009900">$parent</font><font color="#990000">.=</font><font color="#FF0000">"&amp;gt;"</font><font color="#990000">.</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$id</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">];</font>
<font color="#000000">262:</font>         <b><font color="#0000FF">return</font></b> <font color="#009900">$parent</font><font color="#990000">;</font>
<font color="#000000">263:</font>         <font color="#FF0000">}</font>
<font color="#000000">264:</font> <i><font color="#9A1900">/*</font></i>
<font color="#000000">265:</font> 
<font color="#000000">266:</font> <i><font color="#9A1900">Retourne 1 si $var appartient à $liste, 0 sinon.</font></i>
<font color="#000000">267:</font> 
<font color="#000000">268:</font> <i><font color="#9A1900">*/</font></i>
<font color="#000000">269:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">appartient</font></b><font color="#990000">(</font><font color="#009900">$var</font><font color="#990000">,</font><font color="#009900">$liste</font><font color="#990000">)</font>
<font color="#000000">270:</font>          <font color="#FF0000">{</font>
<font color="#000000">271:</font>          <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$val</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$liste</font><font color="#990000">))</font> <font color="#FF0000">{</font><b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$val</font><font color="#990000">==</font><font color="#009900">$var</font><font color="#990000">)</font> <font color="#FF0000">{</font><b><font color="#0000FF">return</font></b> <font color="#993399">1</font><font color="#990000">;</font><font color="#FF0000">}}</font>
<font color="#000000">272:</font>          <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#000000">273:</font>          <font color="#FF0000">}</font>
<font color="#000000">274:</font> <i><font color="#9A1900">/**</font></i>
<font color="#000000">275:</font> <i><font color="#9A1900"> * Retourne l'URL correspondant à la page no $no_page dans la recherche en cours</font></i>
<font color="#000000">276:</font> <i><font color="#9A1900"> */</font></i>
<font color="#000000">277:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">get_link</font></b><font color="#990000">(</font><font color="#009900">$no_page</font><font color="#990000">,</font><font color="#009900">$word</font><font color="#990000">,</font><font color="#009900">$id</font><font color="#990000">)</font>
<font color="#000000">278:</font>          <font color="#FF0000">{</font>
<font color="#000000">279:</font>          <font color="#009900">$buf</font> <font color="#990000">=</font> <b><font color="#000000">getenv</font></b><font color="#990000">(</font><font color="#FF0000">'SCRIPT_NAME'</font><font color="#990000">).</font><font color="#FF0000">"?word="</font><font color="#990000">.</font><b><font color="#000000">urlencode</font></b><font color="#990000">(</font><font color="#009900">$word</font><font color="#990000">).</font><font color="#FF0000">"&amp;id="</font><font color="#990000">.</font><font color="#009900">$id</font><font color="#990000">.</font><font color="#FF0000">"&amp;first="</font><font color="#990000">.</font><font color="#009900">$no_page</font><font color="#990000">;</font>
<font color="#000000">280:</font>          <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><font color="#009900">$nbResultPerPage</font><font color="#990000">)</font> <font color="#FF0000">{</font><font color="#009900">$buf</font><font color="#990000">.=</font><font color="#FF0000">"&amp;nbResultPerPage="</font><font color="#990000">.</font><font color="#009900">$nbResultPerPage</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">281:</font>          <b><font color="#0000FF">return</font></b> <font color="#009900">$buf</font><font color="#990000">;</font>
<font color="#000000">282:</font>          <font color="#FF0000">}</font>
<font color="#000000">283:</font> <i><font color="#9A1900">/**</font></i>
<font color="#000000">284:</font> <i><font color="#9A1900"> * Retourne l'URL correspondant à la categorie no $no_categorie</font></i>
<font color="#000000">285:</font> <i><font color="#9A1900"> */</font></i>
<font color="#000000">286:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">get_link_categorie</font></b><font color="#990000">(</font><font color="#009900">$no_categorie</font><font color="#990000">,</font><font color="#009900">$id</font><font color="#990000">)</font> <font color="#FF0000">{</font><b><font color="#0000FF">return</font></b> <b><font color="#000000">getenv</font></b><font color="#990000">(</font><font color="#FF0000">'SCRIPT_NAME'</font><font color="#990000">).</font><font color="#FF0000">"?categorie=$no_categorie&amp;id=$id"</font><font color="#990000">;</font><font color="#FF0000">}</font>
<font color="#000000">287:</font> 
<font color="#000000">288:</font> <i><font color="#9A1900">/**</font></i>
<font color="#000000">289:</font> <i><font color="#9A1900"> * Retourne le nom du site dans la table responsable correspondant à l'id $id</font></i>
<font color="#000000">290:</font> <i><font color="#9A1900"> */</font></i>
<font color="#000000">291:</font> 
<font color="#000000">292:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">get_name_site</font></b><font color="#990000">(</font><font color="#009900">$id</font><font color="#990000">,</font><font color="#009900">$prefix</font><font color="#990000">)</font>
<font color="#000000">293:</font>         <font color="#FF0000">{</font>
<font color="#000000">294:</font>         <i><font color="#9A1900">#$result = mysql_db_query("circa","select titre from ".$this-&gt;{PREFIX_TABLE}."responsable where id=$id");</font></i>
<font color="#000000">295:</font>         <i><font color="#9A1900">#$sth-&gt;execute() || print "Erreur: $DBI::errstr\n";</font></i>
<font color="#000000">296:</font>         <i><font color="#9A1900">#my ($titre)=$sth-&gt;fetchrow_array;</font></i>
<font color="#000000">297:</font>         <i><font color="#9A1900">#$sth-&gt;finish;</font></i>
<font color="#000000">298:</font>         <b><font color="#0000FF">return</font></b> <font color="#009900">$titre</font><font color="#990000">;</font>
<font color="#000000">299:</font>         <font color="#FF0000">}</font>
<font color="#000000">300:</font> 
<font color="#000000">301:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">get_liste_categorie</font></b><font color="#990000">(</font><font color="#009900">$idr</font><font color="#990000">)</font>
<font color="#000000">302:</font>          <font color="#FF0000">{</font>
<font color="#000000">303:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$database</font><font color="#990000">;</font>
<font color="#000000">304:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$prefix</font><font color="#990000">;</font>
<font color="#000000">305:</font>          <font color="#009900">$requete</font> <font color="#990000">=</font> <font color="#FF0000">"select id,nom,parent from "</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idr</font><font color="#990000">.</font><font color="#FF0000">"categorie"</font><font color="#990000">;</font>
<font color="#000000">306:</font>          <font color="#009900">$result</font> <font color="#990000">=</font> <b><font color="#000000">mysql_db_query</font></b><font color="#990000">(</font><font color="#009900">$database</font><font color="#990000">,</font><font color="#009900">$requete</font><font color="#990000">);</font>
<font color="#000000">307:</font>          <font color="#009900">$RowCount</font> <font color="#990000">=</font> <b><font color="#000000">MySQL_NUMROWS</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">308:</font>          <font color="#009900">$i</font><font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>
<font color="#000000">309:</font>          <b><font color="#0000FF">while</font></b> <font color="#990000">(</font><font color="#009900">$i</font><font color="#990000">&lt;</font><font color="#009900">$RowCount</font><font color="#990000">)</font>
<font color="#000000">310:</font>                 <font color="#FF0000">{</font>
<font color="#000000">311:</font>                 <b><font color="#0000FF">list</font></b> <font color="#990000">(</font><font color="#009900">$idc</font><font color="#990000">,</font><font color="#009900">$nom</font><font color="#990000">,</font><font color="#009900">$parent</font><font color="#990000">)=</font> <b><font color="#000000">mysql_fetch_row</font></b><font color="#990000">(</font><font color="#009900">$result</font><font color="#990000">);</font>
<font color="#000000">312:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$idc</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">]=</font><font color="#009900">$nom</font><font color="#990000">;</font>
<font color="#000000">313:</font>                 <font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$idc</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">]=</font><font color="#009900">$parent</font><font color="#990000">;</font>
<font color="#000000">314:</font>                 <font color="#009900">$i</font><font color="#990000">++;</font>
<font color="#000000">315:</font>                 <font color="#FF0000">}</font>
<font color="#000000">316:</font>         <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <b><font color="#0000FF">list</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$val</font><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">each</font></b> <font color="#990000">(</font><font color="#009900">$tab</font><font color="#990000">))</font>
<font color="#000000">317:</font>                 <font color="#FF0000">{</font>
<font color="#000000">318:</font>                 <font color="#009900">$nom</font><font color="#990000">=</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$key</font><font color="#990000">][</font><font color="#993399">0</font><font color="#990000">];</font>
<font color="#000000">319:</font>                 <font color="#009900">$parent</font><font color="#990000">=</font><font color="#009900">$tab</font><font color="#990000">[</font><font color="#009900">$key</font><font color="#990000">][</font><font color="#993399">1</font><font color="#990000">];</font>
<font color="#000000">320:</font>                 <font color="#009900">$buf</font><font color="#990000">.=</font><font color="#FF0000">"&lt;option value=\"$key\"&gt;"</font><font color="#990000">.</font><b><font color="#000000">getWLParent</font></b><font color="#990000">(</font><font color="#009900">$key</font><font color="#990000">,</font><font color="#009900">$idr</font><font color="#990000">,</font><font color="#009900">$tab</font><font color="#990000">).</font><font color="#FF0000">"&lt;/option&gt;"</font><font color="#990000">;</font>
<font color="#000000">321:</font>                 <font color="#FF0000">}</font>
<font color="#000000">322:</font>         <b><font color="#0000FF">return</font></b> <font color="#009900">$buf</font><font color="#990000">;</font>
<font color="#000000">323:</font>         <font color="#FF0000">}</font>
<font color="#000000">324:</font> 
<font color="#000000">325:</font> <b><font color="#0000FF">function</font></b> <b><font color="#000000">addSite</font></b><font color="#990000">(</font><font color="#009900">$url</font><font color="#990000">,</font><font color="#009900">$categorie</font><font color="#990000">)</font>
<font color="#000000">326:</font>          <font color="#FF0000">{</font>
<font color="#000000">327:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$database</font><font color="#990000">;</font>
<font color="#000000">328:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$prefix</font><font color="#990000">;</font>
<font color="#000000">329:</font>          <b><font color="#0000FF">global</font></b> <font color="#009900">$idr</font><font color="#990000">;</font>
<font color="#000000">330:</font>          <font color="#009900">$requete</font><font color="#990000">=</font><font color="#FF0000">"insert into "</font><font color="#990000">.</font><font color="#009900">$prefix</font><font color="#990000">.</font><font color="#009900">$idr</font><font color="#990000">.</font><font color="#FF0000">"links (url,titre,description,langue,valide,categorie,browse_categorie)</font>
<font color="#000000">331:</font> <font color="#FF0000">                   values ('$url',' ',' ','fr',0,$categorie,'1')"</font><font color="#990000">;</font>
<font color="#000000">332:</font>          <font color="#009900">$result</font> <font color="#990000">=</font> <b><font color="#000000">mysql_db_query</font></b><font color="#990000">(</font><font color="#009900">$database</font><font color="#990000">,</font><font color="#009900">$requete</font><font color="#990000">);</font>
<font color="#000000">333:</font>          <font color="#FF0000">}</font>
<font color="#000000">334:</font> <font color="#990000">?&gt;</font>
</tt></pre>
